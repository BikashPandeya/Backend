<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css"
      rel="stylesheet"
    />
    <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
    rel="stylesheet"
/>
  </head>
  <body>
    <main
      class="flex flex-col items-center justify-center min-h-screen bg-[#1a1f3c] relative"
    >
      <button
        class="absolute top-4 left-4 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded focus:outline-none focus:shadow-outline px-4 py-2 z-[60] transition-all duration-300"
        onclick="showPopup()"
        id="uploadButton"
      >
        Upload File
      </button>
      <div
        class="popup hidden fixed top-0 left-0 w-full h-full bg-[#1a1f3c]/80 backdrop-blur-xl flex items-center justify-center z-50 flex-col"
      >
        <button
          onclick="hidePopup()"
          class="absolute top-6 right-6 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-full w-12 h-12 flex items-center justify-center focus:outline-none focus:shadow-outline transition-all duration-300 shadow-lg"
        >
            <i class="ri-close-line text-2xl "></i>
        </button>
        <form action="/upload-file" method="post" enctype="multipart/form-data" class="flex flex-col items-center">
          <div
            class="flex items-center justify-center w-96 max-w-md mx-auto mt-10 bg-[#1a1f3c] rounded-lg shadow-lg p-6 border border-blue-500/20"
          >
            <label
              for="dropzone-file"
              class="flex flex-col items-center justify-center w-full h-64 border-2 border-blue-500/30 border-dashed rounded-lg cursor-pointer bg-[#1a1f3c] hover:bg-[#1a1f3c]/80 transition-colors duration-300"
            >
              <div id="upload-prompt" class="flex flex-col items-center justify-center pt-5 pb-6">
                <i class="ri-upload-cloud-2-line text-4xl mb-4 text-blue-400"></i>
                <p class="mb-2 text-sm text-blue-300">
                  <span class="font-semibold">Click to upload</span> or drag and
                  drop
                </p>
                <p class="text-xs text-blue-400">
                  SVG, PNG, JPG or GIF (MAX. 800x400px)
                </p>
              </div>
              <div id="file-preview" class="hidden w-full h-full flex flex-col items-center justify-center p-4">
                <div id="preview-container" class="w-full h-40 mb-4 flex items-center justify-center">
                  <!-- Preview will be inserted here -->
                </div>
                <p id="file-name" class="text-blue-300 text-sm truncate max-w-full"></p>
              </div>
              <input
                id="dropzone-file"
                type="file"
                class="hidden"
                name="file"
                required
                onchange="handleFileSelect(event)"
              />
            </label>
          </div>
          <button
            type="submit"
            id="upload-button"
            class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-all duration-300 hidden"
          >
            <i class="ri-upload-2-line mr-2"></i>Upload <span id="upload-filename"></span>
          </button>
        </form>
        <% if (uploadedFiles.length > 0) { %>
            <div class="mt-10 w-full max-w-2xl p-4 rounded-lg bg-white/5 text-white">
              <h2 class="text-lg font-semibold mb-4 text-blue-300">Uploaded Files:</h2>
              <div class="grid grid-cols-2 gap-4">
                <% uploadedFiles.forEach(file => { %>
                  <% if (file.match(/\.(jpg|jpeg|png|gif|webp)$/)) { %>
                    <img src="<%= file %>" alt="Uploaded Image" class="rounded-lg shadow" />
                  <% } else if (file.match(/\.(mp4|webm|ogg)$/)) { %>
                    <video src="<%= file %>" controls class="rounded-lg shadow"></video>
                  <% } else { %>
                    <a href="<%= file %>" class="text-blue-400 underline" target="_blank">Download File</a>
                  <% } %>
                <% }); %>
              </div>
            </div>
          <% } %>
      </div>

      <div class="files flex flex-col gap-2 w-100" >
        <div class="files flex flex-col gap-2 w-full">
          <% files.forEach((file) => { %>
            <div class="p-4 rounded-md bg-gray-300 flex flex-col gap-2">
              <h1 class="text-blue-900 font-semibold"><%= file.originalName %></h1>
        
              <!-- Small preview block -->
              <% if (file.resource_type === "image") { %>
                <img src="<%= file.secure_url %>" alt="preview" class="w-32 h-32 object-cover rounded-md border border-gray-400" />
              <% } else if (file.resource_type === "video") { %>
                <video src="<%= file.secure_url %>" class="w-32 h-32 rounded-md border border-gray-400" muted autoplay loop></video>
              <% } else if (file.format === "pdf") { %>
                <iframe src="<%= file.secure_url %>" class="w-32 h-32 rounded-md border border-gray-400"></iframe>
              <% } else { %>
                <div class="w-32 h-32 flex items-center justify-center bg-gray-200 text-sm text-gray-700 rounded-md border border-gray-400">
                  No Preview
                </div>
              <% } %>
        
              <!-- Download button (unchanged) -->
              <div class="flex justify-end">
                <a href="/download/<%= file.public_id %>">
                  <i class="ri-download-cloud-line text-2xl text-blue-800 hover:text-blue-900"></i>
                </a>
              </div>
            </div>
          <% }) %>
        </div>
        
      </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
    <script>
      function showPopup() {
        document.querySelector(".popup").style.display = "flex";
        document.getElementById("uploadButton").classList.add("blur-sm");
      }

      function hidePopup() {
        document.querySelector(".popup").style.display = "none";
        document.getElementById("uploadButton").classList.remove("blur-sm");
        // Reset file selection when closing popup
        resetFileSelection();
      }

      function handleFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;

        const uploadPrompt = document.getElementById('upload-prompt');
        const filePreview = document.getElementById('file-preview');
        const previewContainer = document.getElementById('preview-container');
        const fileName = document.getElementById('file-name');
        const uploadButton = document.getElementById('upload-button');
        const uploadFilename = document.getElementById('upload-filename');

        // Show file name
        fileName.textContent = file.name;
        uploadFilename.textContent = file.name;

        // Create preview based on file type
        previewContainer.innerHTML = '';
        if (file.type.startsWith('image/')) {
          const img = document.createElement('img');
          img.src = URL.createObjectURL(file);
          img.className = 'max-h-full max-w-full object-contain rounded';
          previewContainer.appendChild(img);
        } else if (file.type.startsWith('video/')) {
          const video = document.createElement('video');
          video.src = URL.createObjectURL(file);
          video.className = 'max-h-full max-w-full rounded';
          video.controls = true;
          previewContainer.appendChild(video);
        } else {
          const icon = document.createElement('i');
          icon.className = 'ri-file-text-line text-5xl text-blue-400';
          previewContainer.appendChild(icon);
        }

        // Show preview and upload button
        uploadPrompt.classList.add('hidden');
        filePreview.classList.remove('hidden');
        uploadButton.classList.remove('hidden');
      }

      function resetFileSelection() {
        const fileInput = document.getElementById('dropzone-file');
        const uploadPrompt = document.getElementById('upload-prompt');
        const filePreview = document.getElementById('file-preview');
        const uploadButton = document.getElementById('upload-button');
        
        fileInput.value = '';
        uploadPrompt.classList.remove('hidden');
        filePreview.classList.add('hidden');
        uploadButton.classList.add('hidden');
      }
    </script>
  </body>
</html>
